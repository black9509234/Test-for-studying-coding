<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lerp 카메라 따라가기</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: white;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const NUM_SQUARES = 30;
  const MAP_WIDTH = 3000;
  const MAP_HEIGHT = 3000;

  const player = {
    x: MAP_WIDTH / 2,
    y: MAP_HEIGHT / 2,
    size: 40,
    speed: 3
  };

  const keys = { w: false, a: false, s: false, d: false };
  const squares = [];

  for (let i = 0; i < NUM_SQUARES; i++) {
    squares.push({
      x: Math.random() * MAP_WIDTH,
      y: Math.random() * MAP_HEIGHT,
      size: 20 + Math.random() * 10
    });
  }

  let camera = {
    x: player.x,
    y: player.y
  };

  function lerp(a, b, t) {
    return a + (b - a) * t;
  }

  window.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = true;
  });
  window.addEventListener('keyup', (e) => {
    if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = false;
  });

  function update() {
    // 플레이어 이동
    if (keys.w) player.y -= player.speed;
    if (keys.s) player.y += player.speed;
    if (keys.a) player.x -= player.speed;
    if (keys.d) player.x += player.speed;

    // 카메라가 플레이어를 부드럽게 따라감
    camera.x = lerp(camera.x, player.x, 0.1);
    camera.y = lerp(camera.y, player.y, 0.1);

    // 화면 클리어
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 맵 오브젝트 그리기 (카메라 위치 보정)
    for (let square of squares) {
      const drawX = square.x - camera.x + canvas.width / 2;
      const drawY = square.y - camera.y + canvas.height / 2;

      ctx.fillStyle = 'yellow';
      ctx.fillRect(drawX, drawY, square.size, square.size);
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 2;
      ctx.strokeRect(drawX, drawY, square.size, square.size);
    }

    // 플레이어 그리기 (항상 중앙 기준으로)
    const playerScreenX = canvas.width / 2 - player.size / 2;
    const playerScreenY = canvas.height / 2 - player.size / 2;
    ctx.fillStyle = 'dodgerblue';
    ctx.fillRect(playerScreenX, playerScreenY, player.size, player.size);
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 2;
    ctx.strokeRect(playerScreenX, playerScreenY, player.size, player.size);

    requestAnimationFrame(update);
  }

  update();
</script>
</body>
</html>
